# คู่มือการใช้งานระบบลูกหนี้เงินกู้

## การเริ่มต้นใช้งาน

### 1. ตั้งค่า Supabase

#### สร้างโปรเจคใหม่
1. ไปที่ [https://supabase.com](https://supabase.com)
2. สร้างโปรเจคใหม่
3. จดบันทึก Project URL และ Anon Key

#### รันคำสั่ง SQL
1. ไปที่ SQL Editor ใน Supabase Dashboard
2. คัดลอกเนื้อหาจากไฟล์ `database.sql`
3. รันคำสั่งทั้งหมด
4. ตรวจสอบว่าตารางถูกสร้างเรียบร้อย:
   - `members`
   - `loan_contracts`
   - `loan_payments`
   - `v_contract_balances` (View)
   - `v_dashboard_summary` (View)
   - `v_contracts_near_due` (View)

#### สร้างผู้ใช้งาน
1. ไปที่ Authentication > Users
2. คลิก "Add User"
3. กรอก Email และ Password
4. ใน User Metadata เพิ่ม:
   ```json
   {
     "role": "admin"
   }
   ```

### 2. ตั้งค่าโปรเจค

#### สร้างไฟล์ .env
```bash
cp .env.example .env
```

#### แก้ไขไฟล์ .env
```env
VITE_SUPABASE_URL=https://your-project.supabase.co
VITE_SUPABASE_ANON_KEY=your-anon-key-here
```

### 3. รันโปรเจค

```bash
# ติดตั้ง Dependencies (ถ้ายังไม่ได้ติดตั้ง)
npm install

# รันในโหมด Development
npm run dev
```

เปิดเบราว์เซอร์ที่ `http://localhost:3000`

---

## การใช้งาน

### เข้าสู่ระบบ
1. ใช้ Email และ Password ที่สร้างใน Supabase
2. คลิก "เข้าสู่ระบบ"

### หน้าหลัก (Dashboard)
- แสดงสรุปข้อมูลสำคัญ:
  - จำนวนสัญญาที่ใช้งาน
  - ลูกหนี้คงค้าง
  - ดอกเบี้ยที่ได้รับ
  - สัญญาค้างชำระ
- แสดงสัญญาใกล้ครบกำหนด (30 วัน)
- แสดงการชำระเงินล่าสุด
- แสดงรายการสัญญาค้างชำระ

### จัดการสมาชิก
1. คลิกเมนู "สมาชิก"
2. ดูรายชื่อสมาชิกทั้งหมด
3. ค้นหาด้วย รหัสสมาชิก, ชื่อ, นามสกุล, หรือเบอร์โทร

### จัดการสัญญาเงินกู้
1. คลิกเมนู "สัญญาเงินกู้"
2. ดูรายการสัญญาทั้งหมด พร้อม:
   - เงินต้น
   - ดอกเบี้ยสะสม
   - ยอดคงเหลือ
   - ความคืบหน้าการชำระ
   - สถานะสัญญา
3. ค้นหาสัญญาด้วย เลขที่สัญญา, รหัสสมาชิก, หรือชื่อ

### จัดการการชำระเงิน
1. คลิกเมนู "การชำระเงิน"
2. ดูประวัติการชำระเงินทั้งหมด
3. กรองตามประเภท:
   - รายงวด
   - ชำระบางส่วน
   - ปิดยอด

---

## การคำนวณดอกเบี้ย

ระบบใช้วิธีคำนวณดอกเบี้ยแบบ Simple Interest (ไม่ทบต้น)

### สูตรการคำนวณ

```
ดอกเบี้ยต่อเดือน = เงินต้น × อัตราดอกเบี้ย / 100
ดอกเบี้ยสะสม = ดอกเบี้ยต่อเดือน × จำนวนเดือนที่ผ่านไป
ยอดรวมที่ต้องชำระ = เงินต้น + ดอกเบี้ยสะสม
ยอดคงเหลือ = ยอดรวมที่ต้องชำระ - ยอดที่ชำระแล้ว
```

### ตัวอย่าง

สัญญาเงินกู้:
- เงินต้น: 100,000 บาท
- อัตราดอกเบี้ย: 1% ต่อเดือน
- ระยะเวลา: 12 เดือน

การคำนวณ:
- ดอกเบี้ยต่อเดือน = 100,000 × 1% = 1,000 บาท
- ดอกเบี้ยสะสม (12 เดือน) = 1,000 × 12 = 12,000 บาท
- ยอดรวมที่ต้องชำระ = 100,000 + 12,000 = 112,000 บาท

หากชำระไปแล้ว 50,000 บาท:
- ยอดคงเหลือ = 112,000 - 50,000 = 62,000 บาท

---

## สถานะสัญญา

### Active (ใช้งาน)
- สัญญายังไม่ครบกำหนด
- ยังมียอดคงเหลือ

### Closed (ปิดแล้ว)
- ชำระเงินครบแล้ว
- ยอดคงเหลือ = 0

### Overdue (เกินกำหนด)
- เลยวันครบกำหนดแล้ว
- ยังมียอดคงเหลือ

---

## ประเภทการชำระเงิน

### Installment (รายงวด)
- ชำระตามงวดที่กำหนด
- แนะนำให้ชำระเท่ากันทุกงวด

### Partial (ชำระบางส่วน)
- ชำระไม่เต็มจำนวนงวด
- สามารถชำระได้ตามความสะดวก

### Close (ปิดยอด)
- ชำระปิดยอดก่อนกำหนด
- ชำระยอดคงเหลือทั้งหมด

---

## การ Deploy

### Deploy บน Netlify

1. Push โค้ดไปยัง GitHub
2. เข้า [Netlify](https://netlify.com)
3. คลิก "New site from Git"
4. เลือก Repository
5. ตั้งค่า Build:
   - Build command: `npm run build`
   - Publish directory: `dist`
6. เพิ่ม Environment Variables:
   - `VITE_SUPABASE_URL`
   - `VITE_SUPABASE_ANON_KEY`
7. คลิก "Deploy site"

---

## การแก้ไขปัญหา

### ไม่สามารถเข้าสู่ระบบได้
1. ตรวจสอบว่าสร้างผู้ใช้ใน Supabase แล้ว
2. ตรวจสอบ Email และ Password
3. ตรวจสอบ Environment Variables

### ไม่มีข้อมูลแสดง
1. ตรวจสอบว่ารันคำสั่ง SQL ครบแล้ว
2. ตรวจสอบ RLS Policies
3. ตรวจสอบ role ของผู้ใช้ (ต้องเป็น admin หรือ staff)

### ข้อผิดพลาด CORS
1. ตรวจสอบ Supabase URL
2. ตรวจสอบ Anon Key
3. ตรวจสอบว่า Domain อนุญาตใน Supabase Settings

---

## การพัฒนาต่อ

### เพิ่มฟีเจอร์ที่แนะนำ

1. **ฟอร์มสร้างสัญญาใหม่**
   - เลือกสมาชิก
   - กรอกเงินต้น
   - กำหนดระยะเวลา
   - สร้างเลขที่สัญญาอัตโนมัติ

2. **ฟอร์มบันทึกการชำระเงิน**
   - เลือกสัญญา
   - กรอกจำนวนเงิน
   - เลือกประเภทการชำระ
   - บันทึกหมายเหตุ

3. **รายงาน**
   - รายงานสรุปรายเดือน
   - รายงานสมาชิกที่ค้างชำระ
   - Export เป็น Excel/PDF

4. **การแจ้งเตือน**
   - แจ้งเตือนสัญญาใกล้ครบกำหนด
   - แจ้งเตือนสัญญาค้างชำระ
   - ส่ง Email/SMS

5. **การจัดการสิทธิ์**
   - แยก role admin/staff
   - จำกัดการเข้าถึงข้อมูล
   - Log การทำงาน

---

## ติดต่อ

หากมีปัญหาหรือข้อสงสัย กรุณาติดต่อทีมพัฒนา
